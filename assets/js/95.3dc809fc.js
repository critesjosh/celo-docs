(window.webpackJsonp=window.webpackJsonp||[]).push([[95],{444:function(e,t,n){"use strict";n.r(t);var a=n(42),s=Object(a.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"calling-oblivious-decentralized-identifier-service-odis"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#calling-oblivious-decentralized-identifier-service-odis"}},[e._v("#")]),e._v(" Calling Oblivious Decentralized Identifier Service (ODIS)")]),e._v(" "),n("p",[e._v("This guide walks through using ContractKit to query the on-chain identifier given a phone number. See "),n("RouterLink",{attrs:{to:"/docs/celo-codebase/protocol/identity/phone-number-privacy.html"}},[e._v("this overview document")]),e._v(" for more details on ODIS. One of Celo's key features is the ability to associate a phone number to a Celo address. This provides a convenient payment experience for Celo users. To map a phone number to an address, the on-chain identifier for a given phone number must first be retrieved. With this identifier, the address can be looked up on-chain.")],1),e._v(" "),n("p",[e._v('{% hint style="info" %}\nODIS requests are rate-limited based on transaction history and balance. Ensure the account that is performing the queries has a balance and has performed transactions on the network. If an out of quota error is hit, this indicates that more transactions need to be sent from the querying account.\n{% endhint %}')]),e._v(" "),n("p",[e._v("There are two methods for ODIS:")]),e._v(" "),n("ol",[n("li",[n("code",[e._v("getPhoneNumberIdentifier")]),e._v(" - Query and compute the identifier for a phone number")]),e._v(" "),n("li",[n("code",[e._v("getContactMatches")]),e._v(" - Find mutual connections between users")])]),e._v(" "),n("h2",{attrs:{id:"authentication"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#authentication"}},[e._v("#")]),e._v(" Authentication")]),e._v(" "),n("p",[e._v("Both methods require authentication to the ODIS server, which can be performed by either the main wallet key or the data-encryption key (DEK) associated with the wallet key. This is managed by "),n("code",[e._v("AuthSigner")]),e._v(", which can be either a "),n("code",[e._v("WalletKeySigner")]),e._v(" for a wallet key or an "),n("code",[e._v("EncryptionKeySigner")]),e._v(" for the DEK. The DEK method is preferred, since it doesn't require the user to access the same key that manages their funds. "),n("RouterLink",{attrs:{to:"/docs/developer-resources/contractkit/data-encryption-key.html"}},[e._v("You can learn more about DEK here.")])],1),e._v(" "),n("p",[e._v("You may use the "),n("code",[e._v("EncryptionKeySigner")]),e._v(" for your "),n("code",[e._v("AuthSigner")]),e._v(" by passing in the raw private key:")]),e._v(" "),n("div",{staticClass:"language-ts extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ts"}},[n("code",[e._v("  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" authSigner"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" AuthSigner "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    authenticationMethod"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" OdisUtils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("Query"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("AuthenticationMethod"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),n("span",{pre:!0,attrs:{class:"token constant"}},[e._v("ENCRYPTION_KEY")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    rawKey"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" privateDataKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),n("p",[e._v("Alternatively, you may use the "),n("code",[e._v("WalletKeySigner")]),e._v(" by passing in a contractkit instance with the account unlocked:")]),e._v(" "),n("div",{staticClass:"language-ts extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ts"}},[n("code",[e._v("  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" authSigner"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" AuthSigner "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    authenticationMethod"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" OdisUtils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("Query"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("AuthenticationMethod"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),n("span",{pre:!0,attrs:{class:"token constant"}},[e._v("WALLET_KEY")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    contractKit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),n("h2",{attrs:{id:"service-context"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#service-context"}},[e._v("#")]),e._v(" Service Context")]),e._v(" "),n("p",[e._v("The "),n("code",[e._v("ServiceContext")]),e._v(" object provides the ODIS endpoint URL and the ODIS public key (same as above).")]),e._v(" "),n("div",{staticClass:"language-ts extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ts"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" serviceContext"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" ServiceContext "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    odisUrl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    odisPubKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),n("p",[e._v("The ODIS endpoint URL for each environment can be found here:")]),e._v(" "),n("table",[n("thead",[n("tr",[n("th",[e._v("Environment")]),e._v(" "),n("th",[e._v("Key")])])]),e._v(" "),n("tbody",[n("tr",[n("td",[e._v("Alfajores Staging")]),e._v(" "),n("td",[e._v("https://us-central1-celo-phone-number-privacy-stg.cloudfunctions.net")])]),e._v(" "),n("tr",[n("td",[e._v("Alfajores")]),e._v(" "),n("td",[e._v("https://us-central1-celo-phone-number-privacy.cloudfunctions.net")])]),e._v(" "),n("tr",[n("td",[e._v("Mainnet")]),e._v(" "),n("td",[e._v("https://us-central1-celo-pgpnp-mainnet.cloudfunctions.net")])])])]),e._v(" "),n("p",[e._v("The ODIS public key for each environment can be found here:")]),e._v(" "),n("table",[n("thead",[n("tr",[n("th",[e._v("Environment")]),e._v(" "),n("th",[e._v("Key")])])]),e._v(" "),n("tbody",[n("tr",[n("td",[e._v("Alfajores Staging")]),e._v(" "),n("td",[e._v("7FsWGsFnmVvRfMDpzz95Np76wf/1sPaK0Og9yiB+P8QbjiC8FV67NBans9hzZEkBaQMhiapzgMR6CkZIZPvgwQboAxl65JWRZecGe5V3XO4sdKeNemdAZ2TzQuWkuZoA")])]),e._v(" "),n("tr",[n("td",[e._v("Alfajores")]),e._v(" "),n("td",[e._v("kPoRxWdEdZ/Nd3uQnp3FJFs54zuiS+ksqvOm9x8vY6KHPG8jrfqysvIRU0wtqYsBKA7SoAsICMBv8C/Fb2ZpDOqhSqvr/sZbZoHmQfvbqrzbtDIPvUIrHgRS0ydJCMsA")])]),e._v(" "),n("tr",[n("td",[e._v("Mainnet")]),e._v(" "),n("td",[e._v("FvreHfLmhBjwxHxsxeyrcOLtSonC9j7K3WrS4QapYsQH6LdaDTaNGmnlQMfFY04Bp/K4wAvqQwO9/bqPVCKf8Ze8OZo8Frmog4JY4xAiwrsqOXxug11+htjEe1pj4uMA")])])])]),e._v(" "),n("h2",{attrs:{id:"query-phone-number-identifier"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#query-phone-number-identifier"}},[e._v("#")]),e._v(" Query phone number identifier")]),e._v(" "),n("p",[e._v('This call consumes quota. When the user runs out of quota, it\'s recommended to prompt the user to "purchase" more quota by sending a transaction to themselves. This method returns the pepper retrieved from the service as well as the the computed on-chain identifier that is generated using this pepper and the phone number.')]),e._v(" "),n("h3",{attrs:{id:"bls-blinding-client"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#bls-blinding-client"}},[e._v("#")]),e._v(" BLS Blinding Client")]),e._v(" "),n("p",[e._v("It's important for user privacy that the ODIS servers don't have the ability to view the raw phone number. Before making the request, the library first blinds the phone number using a BLS library. This prevents the ODIS from being able to see the phone number but still makes the resulting signature recoverable to the original phone number. The blinding client is written in "),n("a",{attrs:{href:"https://github.com/celo-org/celo-threshold-bls-rs",target:"_blank",rel:"noopener noreferrer"}},[e._v("Rust"),n("OutboundLink")],1),e._v(" and compiled to Web Assembly, which is not compatible with React native. If you choose not to pass in a "),n("code",[e._v("BLSBlindingClient")]),e._v(" it will default to the Web Assembly version. You may create a "),n("code",[e._v("ReactBlindingClient")]),e._v(" by calling the constructor with the ODIS public key:")]),e._v(" "),n("div",{staticClass:"language-ts extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ts"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" blsBlindingClient "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ReactBlsBlindingClient")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("odisPubKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),n("p",[e._v("Or use the "),n("code",[e._v("WasmBlsBlindingClient")]),e._v(" if your runtime environment supports Web Assembly:")]),e._v(" "),n("div",{staticClass:"language-ts extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ts"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" blsBlindingClient "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("WasmBlsBlindingClient")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("odisPubKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),n("p",[e._v("Now you're ready to get the phone number identifier. "),n("code",[e._v("OdisUtils.PhoneNumberIdentifier.getPhoneNumberIdentifier")]),e._v(" "),n("RouterLink",{attrs:{to:"/docs/developer-resources/contractkit/reference/modules/_identity_odis_phone_number_identifier_.html#getphonenumberidentifier"}},[e._v("documentation can be found here")]),e._v(".")],1),e._v(" "),n("p",[e._v("The response will be "),n("RouterLink",{attrs:{to:"/docs/developer-resources/contractkit/reference/interfaces/_identity_odis_phone_number_identifier_.phonenumberhashdetails.html"}},[e._v("an object")]),e._v(" with the original phone number, the on-chain identifier (phoneHash), and the phone number's pepper.")],1),e._v(" "),n("p",[e._v("You can view an example of this call in "),n("a",{attrs:{href:"https://github.com/celo-org/celo-monorepo/blob/master/packages/mobile/src/identity/privateHashing.ts",target:"_blank",rel:"noopener noreferrer"}},[e._v("our mobile project here"),n("OutboundLink")],1),e._v(".")]),e._v(" "),n("h2",{attrs:{id:"matchmaking"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#matchmaking"}},[e._v("#")]),e._v(" Matchmaking")]),e._v(" "),n("p",[e._v("Instead of querying for all the user's contact's peppers and consuming the user's quota, it's recommended to only query the pepper before it's actually used (ex. just before sending funds). However, sometimes it's helpful to let your users know that they have contacts already using the Celo network. To do this, you can make use of the matchmaking interface. Given two phone numbers, it will let you know whether the other party has also registered on the Celo network with this identifier. "),n("code",[e._v("OdisUtils.Matchmaking.getContactMatches")]),e._v(" "),n("RouterLink",{attrs:{to:"/docs/developer-resources/contractkit/reference/modules/_identity_odis_matchmaking_.html#getcontactmatches"}},[e._v("documentation can be found here")]),e._v(".")],1),e._v(" "),n("p",[e._v("The response will be a subset of the input "),n("code",[e._v("e164NumberContacts")]),e._v(" that are matched by the matchmaking service.")]),e._v(" "),n("p",[e._v("You can view an example of this call in "),n("a",{attrs:{href:"https://github.com/celo-org/celo-monorepo/blob/master/packages/mobile/src/identity/matchmaking.ts",target:"_blank",rel:"noopener noreferrer"}},[e._v("our mobile project here"),n("OutboundLink")],1),e._v(".")])])}),[],!1,null,null,null);t.default=s.exports}}]);